## 介绍
计算 清洗 处理 规范

## 地址引用
### 绝对引用 $
`$H$16` ，行和列**都**加上$叫绝对引用，不希望发生变化  
选中编辑栏的H16后，按F4，快捷添加$
### 相对引用 

### 混合引用
行或列加上一个$

## 逻辑函数
### if()
`=IF(F1>10, "大于10", "小于等于10")` 如果 F1 大于 10，返回“大于10”，否则返回“小于等于10”。
### iferror()
处理错误
### and()
### or()
### not()

## 文本函数
### mid() 取字符串 
从文本字符串的指定位置提取指定数量的字符。
`=MID("Excel", 2, 3)` 返回“xce”。
### left()
从文本字符串的左侧提取指定数量的字符。  
`=LEFT("Excel", 2)` 返回“Ex”。
### right()
从文本字符串的右侧提取指定数量的字符。  
`=RIGHT("Excel", 3)` 返回“cel”。
### len()
返回文本字符串的长度。
### text()
### replace()
### concat()
CONCAT可以直接连接数据区域（多个单元格）,而CONCATENATE只能将单元格或者文本逐个连接，CONCAT比CONCATENATE更强大。

### Regexextract
功能：用正则表达式提取字符  

提取字符中的所有整数  
`=Regexextract(A1,"\d+")`

### Regexreplace
功能：用正则表达式賛换字符  
把A1中的整理都替换成100
`=Regexreplace(A1,"\d+",100)`

### Regextest
功能：用正则表达式判断是否包含  
判断A1中是否包含数字
`=Regexextract(A1,"d\+")`

### Textjoin
功能：用分隔符连接多个值  
把A1:A10的值用-连接在一起
`=Textjoin("-",,A1:a10)`

### Textsplit
功能：根据分隔符把一个字符串拆分成多个值  
把A1单元格中张三-男-20拆分到3个单元格中
`=Textsplit(A1,"-")`

### Textbefore
功能：提取某个字符前的内容  
提取省之前的省份名称
`=Textbefore(A1,"省")`

### TextAfter
功能：提取某个字符前的内容  
提取市的详细地址
`=Textafter(A1,"市")`

### Unique
功能：提取不重复列表  
提取A列不重复公司名称
`=Unique(A:A)`

### Arraytotext
功能：用逗号连接字符或数字
把A1:A10的值用逗号连接起来
`=Arraytotext(a1:a10)`

### Sequence
功能：生成序列  
生成1~10之间的偶数
`=Sequence(5,,2,2)`

## 查找与引用函数
### vlookup(查找值, 查找范围, 返回列号, [匹配模式]) 垂直方向查找
`=VLOOKUP(查找值, 查找范围, 返回列号, [匹配模式])`  
- 查找值: 要在表格中查找的值。
- 查找范围: 包含查找值和返回值的区域。
- 返回列号: 返回值所在的列号（从查找范围的第一列开始计数）。
- 匹配模式:
  - FALSE 或 0: 精确匹配。
  - TRUE 或 1: 近似匹配（默认值）。
`=VLOOKUP(G1, A1:B10, 2, FALSE)` 在 A1:B10 区域中查找 G1 的值，并返回对应行的第二列值。
#### 示例：精确匹配
假设有一个表格，A 列是产品编号，B 列是产品名称，C 列是产品价格：
|A|B|C|
|---|---|---|
|101|Apple|5.0|
|102|Banana|3.0|
|103|Orange|4.0|

现在需要根据产品编号查找对应的产品名称和价格。
1. 查找产品名称：
  - 公式：`=VLOOKUP(102, A1:C3, 2, FALSE)`
  - 结果：返回 Banana。
  - 解释：在 A1:C3 区域中查找 102，并返回第 2 列（B 列）的值。
2. 查找产品价格：
  - 公式：`=VLOOKUP(103, A1:C3, 3, FALSE)`
  - 结果：返回 4.0。
  - 解释：在 A1:C3 区域中查找 103，并返回第 3 列（C 列）的值。

#### 示例：近似匹配
假设有一个表格，A 列是分数范围，B 列是对应的等级：
|A|B|
|----|----|
|0|F|
|60|D|
|70|C|
|80|B|
|90|A|

现在需要根据分数查找对应的等级。
1. 查找分数为 85 的等级：
  - 公式：`=VLOOKUP(85, A1:B5, 2, TRUE)`
  - 结果：返回 B。
  - 解释：在 A1:B5 区域中查找 85，由于是近似匹配，返回小于或等于 85 的最大值（80）对应的等级。
注意事项  
1. 查找值必须在查找范围的第一列。
2. 匹配模式：
  - 如果使用 FALSE，查找值必须完全匹配，否则返回错误 `#N/A`。
  - 如果使用 TRUE，查找范围的第一列必须按升序排列。
3. 返回列号：从查找范围的第一列开始计数，不能超出查找范围的总列数。

#### 处理错误值
如果查找值不存在，VLOOKUP 会返回 `#N/A`。可以使用 IFERROR 函数处理错误。
1. 查找不存在的产品编号：
  - 公式：`=IFERROR(VLOOKUP(104, A1:C3, 2, FALSE), "未找到")`
  - 结果：返回 未找到。
  - 解释：如果查找值 104 不存在，返回“未找到”。

### hlookup() 水平方向查找
`=HLOOKUP(H1, A1:J2, 2, FALSE)` 在 A1:J2 区域中查找 H1 的值，并返回对应列的第二行值。
### lookup() 
既可以进行垂直查找，也可以进行水平查找，而且还具备：逆序查找的能力。使用Lookup函数：可以帮助你根据给定的结果，查找对应的条件。
### xlookup
功能：多条件查找、从后向前查找  
根据部门(A列)和姓名（b列）查询学历（D列）  
`=Xlookup(“财务部"&"张三",A1:A10&B1:B10,C10:C10)`
### match(查找的值, 查找范围, [匹配模式])
返回指定值在指定范围内的相对位置。  
- 匹配模式
  - 0: 精确匹配。
  - 1: 近似匹配（查找范围必须按升序排列）。
  - -1: 近似匹配（查找范围必须按降序排列）。

`=MATCH("Apple", A1:A10, 0)`返回“Apple”在 A1:A10 中的位置。
### FILTER(数据范围, 条件, [无结果时的返回值])
- 功能：一对多筛选  
- 数据范围: 要筛选的数据区域。
- 条件: 一个逻辑表达式，用于筛选数据。
- [无结果时的返回值]: 可选参数，如果没有符合条件的值，则返回此值（默认为错误值 #CALC!）。

|A|B|C|
|---|---|---|
|姓名|部门|销售额|
|张三|销售部|5000|
|李四|技术部|3000|
|王五|销售部|8000|

筛选出 部门为“销售部” 的所有行：
`=FILTER(A2:C4, B2:B4="销售部")`
结果：  
|A|B|C|
|---|---|---|
|姓名|部门|销售额|
|张三|销售部|5000|
|王五|销售部|8000|

筛选出 销售额大于 4000 的所有行：
`=FILTER(A2:C4, C2:C4>4000)`
结果：
|A|B|C|
|---|---|---|
|姓名|部门|销售额|
|张三|销售部|5000|
|王五|销售部|8000|

多条件筛选：  
筛选出 部门为“销售部”且销售额大于 4000 的所有行：  
`=FILTER(A2:C4, (B2:B4="销售部") * (C2:C4>4000))`  

条件：`(B2:B4="销售部") * (C2:C4>4000) 是两个条件的逻辑与运算。` 
星号 * 与，表示同时满足多个条件   
加号 + 或 ，表示满足任意一个条件  



### find(查找的文本, 在哪个文本中查找, [开始位置])
- 单个参数 find("word",A1)
- 多个参数 find({"hello","word"},A1)
### search
支持通配符
### index()
返回指定行和列的单元格值。
`=INDEX(A1:C10, 2, 3)` 返回 A1:C10 区域中第 2 行第 3 列的值。

### choose

## 统计函数
### int() 取整
### mod()
### round()
`=ROUND(3.14159, 2)` 返回 3.14。
### average()
`=AVERAGE(B1:B10)` 计算 B1 到 B10 单元格的平均值。
### max()
`=MAX(C1:C10)` 返回 C1 到 C10 单元格中的最大值。
### min()
`=MIN(D1:D10)` 返回 D1 到 D10 单元格中的最小值。
### sum()
`=SUM(A1:A10)` 计算 A1 到 A10 单元格的总和。
### count()
`=COUNT(E1:E10)` 计算 E1 到 E10 单元格中数值的个数。
### countif()
`=COUNTIF(B1:B10, ">5")` 计算 B1 到 B10 中大于 5 的数值个数。
### countifs()
### sumif(条件区域，一个条件，求和区域)
`=SUMIF(A1:A10, ">10")` 对 A1 到 A10 中大于 10 的数值求和。
### sumifs(求和区域，条件区域1，条件1，条件区域2，条件2...) 
多条件求和  
`=sumifs(A1:A14,B1:B14,">5",C1:C14,"A类")`
### rank
### fv
### pv
### dmax
### dmin


### Pivotby
功能：用公式实现数据透视，支持多列多表  
根据城市（A列）和产品（B列）透视销量（C列）  
`=pivotby(A1:A10,B1:B10,C1:C10,Sum,3)`

### Groupby
功能：用公式分类汇总，支持多列多表
根据城市（A列）和产品（B列）汇总销量（C列）  
`=Groupby(A1:B10,C1:C10,Sum,3)`

### sort
功能：对表格进行排序  
按表格的第3列降序排列
`=SORT(A1:D10,3,-1)`

### sortBy
功能：多列排序  
按表格的C列、D列升序排列
`=SORTBY(A2:D11,C2:C11,1,D2:D11,1)`

## 日期函数
### year() 求年
### month() 求月
### day() 求日
### hour
### minute
### second
### today() 当前日期
### date() 计算给定的日期
### now() 当前日期和时间
### dateif() 计算日期差

## 信息函数
### isBlank
### isNumber
### isText

## 工程函数
### 进制转换

### lambda
功能：自定义函数
例如：定义一个两个数相加的函数
`=Lambda(x,y,x+y)`

## 计算函数
### SumProduct

### Reduce
功能：遍历数组内每个值，累计出运算结果  
把A1:A10中的正数累加
`=Reduce(0,a1:A10,Lambda(x,y,IF(y>0,x+y,x)))`

### Scan
功能：和Reduce同样的运算模式，区别是保存每一次运算结果  
把A1:A10中的正数累加并返回每次累计结果
·=Reduce(0,a1:A10,Lambda(x,y,IF(y>0,x+y,x)))·
### Map
功能：对数组的每个值进行处理，并返回每个值

把A1:A10中空值替换为大写零

`=Map(A1:A10,lambda(X,IF(X=0,"零",X)))`

### Let
功能：定义名称用来简化公式

对Vlookup查找结果进行判断

`=Let(x,vlookup(d1,a:b,2,0),if(x>10,”完成",“未完成"))`

### Byrow
功能：对每一行值进行运算

返回区域每一行平均值

`=Byrow(b2:f5,AVERAGE)`
### ByCol
功能：对每一列值进行运算返回多个结果

返回区域每一列平均值

`=ByCol(b2:f5,AVERAGE)`

## 表格函数
### Vstack 
功能：垂直向合并多个表格
合并1~12月表格
`=Vstack('1月:12月'!A1:B100)`

### Hstack
功能：横向合并多个表格
把A列、C列、F列合并成一个新表格
`=Hstack(A1:A10,C1:C10,F1:F10)`

### ChooseCols
功能：从表格中提取部分列  
提取表格的1，2，5列
`=ChooseCols(A1:G10,1,2,5)`

### ChooseRows 提取数据
功能：从表格中提取部分行  
提取表格的1，2，5行
`=ChooseRows(A1:G10,1,2,5)`

### Tocol
功能：把多列值转换成一列  
把A1:F10区域转换成一列
`=Tocol(A1:F10)`

### ToRow
功能：把多列值转换成一行  
把A1:F10区域转换成一行
`=ToRow(A1:F10)`

### Drop
功能：删除表格的行或列  
删除表格的第1行
`=`Drop(a1:a100,1)`

### Take
功能：提取表格的前/行N行或N列  
提取表格的前10行
`=Take(a1:f100,10)`

## 函数组合
- IF(OR(A1>60,A2>60,A3>60),"True","False")
- isnumber(find("word",A1),"是"，否)
### 函数执行顺序
跟代码执行顺序相同。先进入函数（从左侧），有条件判断条件，后面有函数再执行函数。
总结：从左到右，从外到内，先里头后封口
来自deepseek:  
#### 运算符优先级
|优先级|运算符|说明|
|---|---|---|
| 0 |():(括号)|括号优先级最高|
| 1 | :(冒号)|范围引用（如 A1:B10） |
| 2 | （空格）|交叉引用（如 A1 B1） |
| 3 | ,（逗号）|联合引用（如 A1,B1） |
| 4 | -（（负号）|联合引用（如 A1,B1） |
| 5 | %（百分号）|百分比（如 20%） |
| 6 | ^（乘方）|幂运算（如 2^3） |
| 7 | * 和 /|乘法和除法 |
| 8 |+ 和 -| 加法和减法 |
| 9 |&（连接符）| 文本连接（如 "Sheet" & "!" & "B2"），输出Sheet!B2 |
| 10 |=, <>, <=, >=, <, >| 比较运算符 |

#### 函数嵌套规则
当公式中包含多个嵌套函数时，Excel 会从 最内层函数 开始计算，逐步向外层计算。
`=IF(SUM(A1:A10) > 100, "达标", "未达标")`
- 执行顺序：
  1. 先计算 SUM(A1:A10)，得到 A1:A10 的总和。
  2. 然后比较 SUM(A1:A10) > 100，判断是否大于 100。
  3. 最后根据比较结果返回 "达标" 或 "未达标"。

`=IF(AND(A1 > 10, B1 < 5), SUM(C1:C10), AVERAGE(D1:D10))`
- 执行顺序：
  1. 计算 A1 > 10 和 B1 < 5。
  2. 使用 AND 函数判断两个条件是否同时成立。
  3. 如果 AND 返回 TRUE，则计算 SUM(C1:C10)。
  4. 如果 AND 返回 FALSE，则计算 AVERAGE(D1:D10)。
  5. 最后返回 SUM 或 AVERAGE 的结果。

`=IF(OR(A1 > 10, B1 < 5), SUM(C1:C10) * 2, AVERAGE(D1:D10) / 2)`
- 执行顺序
  1. 计算 A1 > 10 和 B1 < 5。
  2. 使用 OR 函数判断两个条件是否至少有一个成立。
  3. 如果 OR 返回 TRUE，则计算 SUM(C1:C10)，然后乘以 2。
  4. 如果 OR 返回 FALSE，则计算 AVERAGE(D1:D10)，然后除以 2。
  5. 最后返回计算结果。

#### 调试公式执行顺序
如果需要查看公式的执行顺序，可以使用 公式求值 功能.
1. 选中包含公式的单元格。
2. 点击菜单栏中的 公式 > 公式求值。
3. 在弹出的对话框中，逐步点击 求值 按钮，查看每一步的计算结果

#### 逻辑短路计算
- 对于 AND 和 OR 函数，Excel 会进行短路计算：
  - AND：如果某个条件为 FALSE，则不再计算后续条件。
  - OR：如果某个条件为 TRUE，则不再计算后续条件。

#### 公式中的数据运算
`{}`数组公式  
如果公式中包含数组运算（如 SUMPRODUCT 或 {} 数组公式），Excel 会先计算数组部分，再进行其他运算。




